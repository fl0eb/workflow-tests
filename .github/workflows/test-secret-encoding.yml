name: Test Secret Encoding

on:
  workflow_dispatch:

jobs:
  encode-secret:
    runs-on: ubuntu-latest
    steps:
      - name: Fetch and use ksb_session cookie
        run: |
          # GET request and extract ksb_session cookie
          KSB_COOKIE=$(curl -i -s "${{ vars.STRATO_API }}" | grep -i "set-cookie:" | grep -i "ksb_session" | sed 's/.*\(ksb_session=[^;]*\).*/\1/')
          
          echo "Cookie found: $KSB_COOKIE"
          
          # POST request using the cookie
          curl -X POST "${{ vars.STRATO_API }}" \
            -H "Cookie: $KSB_COOKIE" \
            -d "identifier=${{ secrets.STRATO_IDENTIFIER }}" \
            -d "passwd=${{ secrets.STRATO_PASSWORD }}" \
            -d "action_customer_login.x=Login" \
            -v
